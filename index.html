<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Solpump Mini</title>

<style>
body {
  background: #070b2a;
  color: #fff;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
}
.card {
  background: #0d1440;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}
.btn {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 18px;
  font-weight: bold;
  background: #19ff9c;
  cursor: pointer;
}
.btn.stop {
  background: #222;
  color: #aaa;
}
input {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  margin-bottom: 10px;
}
.multiplier {
  font-size: 56px;
  text-align: center;
  font-weight: bold;
}
.history {
  display: flex;
  gap: 8px;
  overflow-x: auto;
}
.history span {
  padding: 6px 10px;
  background: #111a55;
  border-radius: 8px;
}
</style>
</head>

<body>

<h2>ðŸš€ Solpump Mini</h2>

<div class="card">
  <button class="btn" onclick="connectWallet()">Connect Phantom Wallet</button>
  <div id="wallet"></div>
</div>

<div class="card">
  <div class="history" id="history"></div>
</div>

<div class="card">
  <div class="multiplier" id="multiplier">1.00x</div>

  <label>Bet Points</label>
  <input id="betPoints" type="number" value="50"/>

  <label>Auto Cashout (x)</label>
  <input id="autoCashout" type="number" step="0.01" value="2.00"/>

  <button class="btn" onclick="startGame()">START</button>
  <button class="btn stop" onclick="stopGame()">STOP</button>

  <p>Your Points: <span id="points">1000</span></p>
</div>

<script>
/* ================== STATE ================== */
let userPoints = 1000;
let currentMultiplier = 1.0;
let crashPoint = 0;
let isPlaying = false;
let hasCashedOut = false;
let interval = null;

/* ================== WALLET ================== */
async function connectWallet() {
  if (window.solana?.isPhantom) {
    const res = await window.solana.connect();
    document.getElementById("wallet").innerText =
      "Wallet: " + res.publicKey.toString().slice(0,4) + "..." +
      res.publicKey.toString().slice(-4);
  } else {
    alert("Open in Phantom browser");
  }
}

/* ================== GAME ================== */
function startGame() {
  if (isPlaying) return;

  const bet = Number(betPoints.value);
  if (bet <= 0 || bet > userPoints) {
    alert("Invalid bet");
    return;
  }

  // reset ONLY when starting new round
  currentMultiplier = 1.0;
  document.getElementById("multiplier").innerText = "1.00x";

  userPoints -= bet;
  updatePoints();

  crashPoint = generateCrashPoint();
  hasCashedOut = false;
  isPlaying = true;

  interval = setInterval(gameLoop, 50);
}

function gameLoop() {
  if (!isPlaying) return;

  currentMultiplier += 0.01;
  document.getElementById("multiplier").innerText =
    currentMultiplier.toFixed(2) + "x";

  const auto = Number(autoCashout.value);
  if (auto > 0 && currentMultiplier >= auto && !hasCashedOut) {
    cashOut();
  }

  if (currentMultiplier >= crashPoint) {
    crash();
  }
}

function stopGame() {
  if (!isPlaying || hasCashedOut) return;
  cashOut();
}

function cashOut() {
  hasCashedOut = true;
  isPlaying = false;
  clearInterval(interval);

  const bet = Number(betPoints.value);
  const win = Math.floor(bet * currentMultiplier);
  userPoints += win;
  updatePoints();

  addHistory(currentMultiplier);
}

function crash() {
  clearInterval(interval);
  isPlaying = false;

  document.getElementById("multiplier").innerText =
    crashPoint.toFixed(2) + "x";

  addHistory(crashPoint);
}

function updatePoints() {
  document.getElementById("points").innerText = userPoints;
}

/* ================== HELPERS ================== */
function generateCrashPoint() {
  const r = Math.random();
  if (r < 0.6) return +(1 + Math.random()).toFixed(2);     // 1.0 â€“ 2.0
  if (r < 0.9) return +(2 + Math.random() * 3).toFixed(2); // 2 â€“ 5
  return +(5 + Math.random() * 5).toFixed(2);             // 5 â€“ 10
}

function addHistory(x) {
  const h = document.getElementById("history");
  const span = document.createElement("span");
  span.innerText = x.toFixed(2) + "x";
  h.prepend(span);
}
</script>

</body>
    </html>
